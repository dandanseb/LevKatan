<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ××¢×¨×›×ª - ××“××™×Ÿ</title>
    <link rel="icon" href="lev katan.jpg" type="image/jpeg">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; }
        
        .top-bar {
            background: #333; color: white;
            padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .brand-area { display: flex; align-items: center; gap: 10px; }
        .brand-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #555; }
        
        .nav-links { display: flex; gap: 20px; }
        .nav-item { color: #ccc; text-decoration: none; font-size: 14px; transition: 0.2s; }
        .nav-item:hover { color: white; text-decoration: underline; }

        .container { max-width: 1200px; margin: 30px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #eee; padding: 12px; text-align: right; border-bottom: 2px solid #ddd; font-weight: bold; color: #555; }
        td { padding: 12px; border-bottom: 1px solid #eee; color: #333; }
        
        select { padding: 6px; border-radius: 4px; border: 1px solid #ccc; }
        .btn-delete { background: #FFEBEE; color: #D32F2F; border: 1px solid #FFCDD2; padding: 6px 12px; cursor: pointer; border-radius: 6px; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-delete:hover { background: #FFCDD2; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="brand-area">
            <img src="lev katan.jpg" alt="Logo" class="brand-logo">
            <span style="font-weight:bold; font-size:18px;">×¤×× ×œ × ×™×”×•×œ</span>
        </div>
        
        <div class="nav-links">
            <a href="user_dashboard.html" class="nav-item">ğŸª‘ ××¢×‘×¨ ×œ×§×˜×œ×•×’</a>
            <span style="color:#555">|</span>
            <a href="employee_dashboard.html" class="nav-item">ğŸ› ï¸ ××¢×‘×¨ ×œ×××©×§ ×¢×•×‘×“</a>
        </div>

        <div>
            <span id="userGreeting" style="margin-left:15px; font-size:14px;"></span>
            <button onclick="logout()" style="background:none; border:1px solid #777; color:#ddd; padding:4px 10px; border-radius:4px; cursor:pointer;">×™×¦×™××”</button>
        </div>
    </div>

    <div class="container">
        <h2 style="border-bottom: 2px solid #FF69B4; padding-bottom: 10px; color: #333;">××©×ª××©×™× ×¨×©×•××™×</h2>
        <table id="usersTable">
            <thead>
                <tr>
                    <th>××¡×¤×¨ ×¡×™×“×•×¨×™</th> <th>×©× ××œ×</th>
                    <th>×©× ××©×ª××©</th>
                    <th>×˜×œ×¤×•×Ÿ</th> <th>××™××™×™×œ</th> <th>×ª×¤×§×™×“</th>
                    <th>×¤×¢×•×œ×•×ª</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const API_URL = "https://levkatan-api-dxh8azfdfua6e9gn.israelcentral-01.azurewebsites.net/api";
        const token = localStorage.getItem('userToken');
        const username = localStorage.getItem('username');

        if(!token || localStorage.getItem('userRole') !== 'admin') window.location.href = 'index.html';
        document.getElementById('userGreeting').innerText = `×©×œ×•×, ${username}`;

        async function loadUsers() {
            const res = await fetch(`${API_URL}/admin/users`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const users = await res.json();
            
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.full_name}</td>
                    <td>${u.username}</td>
                    <td>${u.phone_number || '-'}</td>
                    <td>${u.email}</td>
                    <td>
                        <select onchange="changeRole(${u.id}, this.value)">
                            <option value="user" ${u.role === 'user' ? 'selected' : ''}>User</option>
                            <option value="employee" ${u.role === 'employee' ? 'selected' : ''}>Employee</option>
                            <option value="admin" ${u.role === 'admin' ? 'selected' : ''}>Admin</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn-delete" onclick="deleteUser(${u.id})">
                            ğŸ—‘ï¸ ××—×§ ××©×ª××©
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function changeRole(id, newRole) {
            await fetch(`${API_URL}/admin/users/${id}/role`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ role: newRole })
            });
            alert("×ª×¤×§×™×“ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”");
        }

        async function deleteUser(id) {
            if(!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××©×ª××© ×–×”? ×”×¤×¢×•×œ×” ×”×™× ×¡×•×¤×™×ª.")) return;
            await fetch(`${API_URL}/admin/users/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            loadUsers();
        }

        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
        loadUsers();
    </script>
</body>
</html>