<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ×¢×•×‘×“×™× - ×œ×‘ ×§×˜×Ÿ</title>
    <link rel="icon" href="lev katan.jpg" type="image/jpeg">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #E0F7FA; margin: 0; }
        
        .top-bar {
            background: white; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        .brand-area { display: flex; align-items: center; gap: 10px; }
        .brand-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background-color: #f9f9f9; color: #006064; }
        
        .btn-approve { background: #4CAF50; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition:0.2s; }
        .btn-approve:hover { background: #388E3C; }
        
        .btn-reject { background: #EF5350; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition:0.2s; margin-right: 5px; }
        .btn-reject:hover { background: #D32F2F; }

        .nav-link { color: #00838F; text-decoration: none; font-weight: bold; margin-left: 20px; font-size: 14px; }
        .nav-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="brand-area">
            <img src="lev katan.jpg" alt="Logo" class="brand-logo">
            <h2 style="margin:0; font-size: 20px; color:#006064;">×××©×§ ×¢×•×‘×“</h2>
        </div>
        <div>
            <a href="user_dashboard.html" class="nav-link">â† ×¢×‘×•×¨ ×œ×§×˜×œ×•×’ (×”×©××œ×” ×¨×’×™×œ×”)</a>
            <span id="userGreeting" style="margin: 0 15px; font-weight:600; color:#555;"></span>
            <button onclick="logout()" style="background:none; border:1px solid #ccc; padding:5px 10px; border-radius:4px; cursor:pointer;">×™×¦×™××”</button>
        </div>
    </div>

    <div class="container">
        <h3>ğŸ ×‘×§×©×•×ª ×”×©××œ×” ×××ª×™× ×•×ª ×œ××™×©×•×¨</h3>
        <table id="requestsTable">
            <thead>
                <tr>
                    <th>×©× ×”××©×ª××©</th>
                    <th>×”××•×¦×¨</th>
                    <th>×ª××¨×™×š ×‘×§×©×”</th>
                    <th>×¤×¢×•×œ×•×ª</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const API_URL = "https://levkatan-api-dxh8azfdfua6e9gn.israelcentral-01.azurewebsites.net/api";
        const token = localStorage.getItem('userToken');
        const username = localStorage.getItem('username');

        if(!token) window.location.href = 'index.html';
        document.getElementById('userGreeting').innerText = username;

        async function loadRequests() {
            const res = await fetch(`${API_URL}/employee/requests`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if(res.status === 403) { alert("××™×Ÿ ×œ×š ×’×™×©×”!"); window.location.href = 'index.html'; return; }
            
            const reqs = await res.json();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = reqs.map(r => `
                <tr>
                    <td>${r.username}</td>
                    <td>${r.product}</td>
                    <td>${r.date.split(' ')[0]}</td>
                    <td>
                        <button class="btn-approve" onclick="updateStatus(${r.id}, 'approved')">××©×¨ âœ…</button>
                        <button class="btn-reject" onclick="updateStatus(${r.id}, 'rejected')">×“×—×” âŒ</button>
                    </td>
                </tr>
            `).join('');
            if(reqs.length === 0) tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>××™×Ÿ ×‘×§×©×•×ª ×××ª×™× ×•×ª ×›×¨×’×¢ ğŸ‰</td></tr>";
        }

        async function updateStatus(id, status) {
            await fetch(`${API_URL}/employee/requests/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ status })
            });
            loadRequests();
        }

        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
        loadRequests();
    </script>
</body>
</html>